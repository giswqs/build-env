on:
    push:
        branches:
            - master
    pull_request:
        branches:
            - master

name: macOS build
jobs:
  test-macOS:
    runs-on: macos-latest
    steps:   
        - uses: actions/checkout@v2
          with:
            submodules: recursive
        - name: Set up Python
          uses: actions/setup-python@v2
          with:
            python-version: 3.9
        - name: install dependencies
          run: brew install gdal
        - name: set up gdal
          run: |
            GDAL_VER=$(find /usr/local/Cellar/gdal/  -name "lib" | awk -F"/" '{print $7}')
            GDAL_LDPATH=/usr/local/Cellar/gdal/$GDAL_VER/lib/
            export LIBRARY_PATH=$GDAL_LDPATH
            echo $LIBRARY_PATH
        - name: Test GDAL installation
          run: |
            gdalinfo --version
        - name: Install other dependencies
          run: |
            python -m pip install --upgrade pip
            pip install --no-cache-dir Cython
            pip install -r requirements.txt -r requirements_dev.txt